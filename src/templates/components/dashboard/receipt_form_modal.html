<div
  x-show="showFormModal"
  x-cloak
  class="fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm px-4"
  @click.self="showFormModal = false"
  @keydown.escape.window="showFormModal = false"
  x-transition:enter="transition ease-out duration-200"
  x-transition:enter-start="opacity-0"
  x-transition:enter-end="opacity-100"
  x-transition:leave="transition ease-in duration-150"
  x-transition:leave-start="opacity-100"
  x-transition:leave-end="opacity-0"
>
  <div
    class="bg-white rounded-2xl shadow-xl w-full max-w-4xl overflow-hidden"
    x-transition:enter="transition ease-out duration-200 transform"
    x-transition:enter-start="opacity-0 scale-95"
    x-transition:enter-end="opacity-100 scale-100"
    x-transition:leave="transition ease-in duration-150 transform"
    x-transition:leave-start="opacity-100 scale-100"
    x-transition:leave-end="opacity-0 scale-95"
  >
    <div class="flex items-center justify-between px-6 py-4 border-b border-gray-100" x-data="{closeModal() { showFormModal = false; }}">
      <h3 class="text-lg font-semibold text-slate-800" x-text="form.id === null ? 'Thêm hoá đơn mới' : 'Sửa hoá đơn'"></h3>
      {% include "components/base/close_button.html" with on_click="closeModal" %}
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-0">
      <div class="p-6 space-y-4 border-r border-gray-100">
        {% include "components/form/input.html" with label="Mã hoá đơn" on_enter_key="submitForm" placeholder="Ví dụ: HD2025XXXX" required=True helper_text="Mã hóa đơn chỉ được chứa chữ cái, số, dấu gạch ngang và dấu gạch dưới." model_key="form.code" error_text_key="errors.code" wrapper_class="mb-0" %}

        {% include "components/form/textarea.html" with label="Mô tả" placeholder="Nhập mô tả chi tiết" rows=4 model_key="form.description" show_optional=True textarea_class="resize-none" %}

        {% include "components/form/file_input.html" with icon="components/icons/image_plus.html" text="Chọn ảnh" file_input_ref="imageInputRef" label="Ảnh hoá đơn" accept=allowed_image_types required=True error_text_key="errors.image" file_name_key="form.image_name" on_change="onFileChange" %}

        <div class="text-xs text-error" x-show="errors.form" x-text="errors.form"></div>
      </div>

      <div class="p-6 bg-gray-50 flex flex-col items-center justify-center gap-4">
        <template x-if="form.image_url">
          <div class="w-full">
            <p class="text-sm text-slate-600 mb-3">Xem trước ảnh</p>
            <div class="w-full bg-white rounded-lg border border-gray-200 flex items-center justify-center h-64 overflow-hidden">
              <img :src="form.image_url" alt="Preview" class="w-full h-full object-contain">
            </div>
          </div>
        </template>

        <template x-if="!form.image_url">
          <div class="text-center text-slate-500">
            <svg class="w-12 h-12 mx-auto mb-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
            </svg>
            <p>Chọn ảnh để xem trước</p>
          </div>
        </template>
      </div>
    </div>

    <div class="flex justify-end gap-3 px-6 py-4 border-t border-gray-100">
      {% include "components/form/text_button.html" with text="Huỷ" on_click="showFormModal = false" class="!h-[40px] !px-4 !bg-gray-500 hover:!bg-gray-600" %}
      {% include "components/form/text_button.html" with text="Lưu" has_spinner=True on_click="submitForm" loading_key="formLoading" class="!h-[40px] !px-4 !bg-primary hover:!bg-primary/90" %}
    </div>
  </div>
</div>
